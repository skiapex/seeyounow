<!-- Use view helpers (e.g. link_to and image_tag) -->
<!-- and implement real data -->

<% content_for(:body_attributes) do %>
    data-no-turbolink="true"
  <% end %>

<head>
    <title>SeeYouNow | Patient Profile</title>
</head> 

<h3 class="page-header">
  <%= @patient.first_name %> <%= @patient.last_name %>
  <span class="pull-right">
    <%= link_to "Edit", edit_patient_path, class: 'btn btn-u btn-success' %>
  </span>
</h3>
 <h3 span class="diagnosis"><%= @patient.diagnosis %>
 <span class="pull-right">
    <%= link_to "Complete ESAS assessment", new_esas_assessment_path, class: 'btn btn-u btn-success' %>
  </span>
</h3>
<h3 span class="nul">
 <span class="pull-right">
    <%= link_to "Complete PFRS assessment", new_prfs_assessment_path, class: 'btn btn-u btn-success' %>
  </span>
</h3>

<!--=== ESAS Chart JS ===-->
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
  google.load('visualization', '1.1', {packages: ['line']});
  google.setOnLoadCallback(drawChart);

  function drawChart() {

    var data = new google.visualization.DataTable();
    data.addColumn('datetime', 'Date');
    data.addColumn('number', 'Pain');
    data.addColumn('number', 'Tiredness');
    data.addColumn('number', 'Drowsiness');
    data.addColumn('number', 'Nausea');
    data.addColumn('number', 'Lack of Appetite');
    data.addColumn('number', 'Shortness of Breath');
    data.addColumn('number', 'Depression');
    data.addColumn('number', 'Wellbeing');
    data.addColumn('number', 'Other Problem');

    data.addRows([
      <% @esas_assessments.each do |esas_assessment| %>
        [ new Date(<%= esas_assessment.created_at.year %>, <%= esas_assessment.created_at.month.to_i - 1 %>, <%= esas_assessment.created_at.day %>, <%= esas_assessment.created_at.hour %>, <%= esas_assessment.created_at.min %>, 0), <%= "#{esas_assessment.pain}, #{esas_assessment.tiredness}, #{esas_assessment.drowsiness}, #{esas_assessment.nausea}, #{esas_assessment.lack_of_appetite}, #{esas_assessment.shortness_of_breath}, #{esas_assessment.depression}, #{esas_assessment.wellbeing}, #{esas_assessment.other_symptom_score}" %>],
      <% end %>
    ]);

    var options = {
      chart: {
        title: 'Profile of Symptom Severity Over Time',
        subtitle: 'severity at the time of assessment of each symptom rated from 0 to 10 on a numerical scale, 0 meaning that the symptom is absent and 10 that it is of the worst possible severity'
      },
      width: 900,
      height: 500
    };

    var chart = new google.charts.Line(document.getElementById('linechart_material'));

    chart.draw(data, options);
  }
</script>
<!--=== End ESAS Chart JS ===-->

<body>
<!--=== Profile ===-->
    <div class="profile container content">
      <div class="row">
            <div class="col-md-12">
              <!--Profile Body-->
              <div class="profile-body">

                <div class="row"><!--start row-->

                  <!--=== Goals of Care Block ===-->
                  <div class="bg-color-light">
                      <div class="who margin-bottom-30">
                          <div class="headline-center">
                              <h2>Goals of Care </h2>
                              <h3><p><%= @patient.goals_of_care %></p></h3>
                          </div>
                      </div>
                  </div>
                  <!--=== End Goals of Care Block ===-->

                <% if current_clinician %>

                  <!--=== ESAS Chart Block ===-->
                  <div class="container content-sm">
                      <div id="linechart_material"></div>
                  </div>
                  <!--=== ESAS Chart Block ===-->

                  <!--Patient Information-->
                  <div class="col-sm-4">
                      <div class="who margin-bottom-30">
                          <div class="headline"><h3>Patient Information</h3></div>
                          <ul class="list-unstyled">
                              <li><strong>Gender:</strong> <%= @patient.gender.gender_type if @patient.gender %></li>
                              <li><strong>Age:</strong> <%= @patient.age %></li>
                          </ul>
                          <ul class="list-unstyled">
                              <li><a href="http://maps.google.com/?q=<%= @patient.address %>"><i class="fa fa-home"></i><%= @patient.address %></a></li>
                              <li><a href="mailto:<%= User.find_by(id: @patient.user_id).email %>"><i class="fa fa-envelope-o"></i><%= User.find_by(id: @patient.user_id).email %></a></li>
                              <li><i class="fa fa-phone"></i><%= @patient.phone_number %></li>
                              <% if @esas_assessments.last == nil %>
                                <li><i class="fa fa-heartbeat"></i><strong>Other symptom:</strong> <%= OtherSymptom.find_by(id: @patient.other_symptom).symptom_type %></li>
                              <% else %>
                                <li><i class="fa fa-heartbeat"></i><strong>Last other symptom:</strong> <%= @esas_assessments.last.other_symptom.symptom_type %></li>
                              <% end %>
                              <li><i class="fa fa-user-md"></i><strong>Primary Clinician: </strong><%= link_to @patient.clinician.full_name, clinician_path(@patient.clinician) %></li>
                              <li><i class="fa fa-group"></i><strong>Caregiver name: </strong><%= @patient.caregiver_name %></li>
                          </ul>
                      </div>

                  </div>
                  <!--End Patient Information-->

                  <!--Notifications Post-->
                  <div class="col-sm-4">
                      <div class="panel panel-profile">
                          <div class="panel-heading overflow-h">
                              <h2 class="panel-title heading-sm pull-left"><i class="fa fa-line-chart"></i>Notifications</h2>
                          </div>
                          <div id="scrollbar4" class="panel-body contentHolder">
                            <% @notifications.sort_by{|e| e[:created_at]}.reverse.each do |notification| %>
                                <div class="comment">
                                    <div class="overflow-h">
                                      <% if notification.is_a?(EsasAssessment) %>
                                        <strong><%= link_to "ESAS Assessment", esas_assessment_path(notification) %><small class="pull-right"> <%= time_ago_in_words(notification.created_at) %></small></strong> 
                                        <p>Highest score: <%= [notification.pain, notification.tiredness, notification.drowsiness, notification.nausea, notification.lack_of_appetite, notification.shortness_of_breath, notification.depression, notification.wellbeing, notification.other_symptom_score].max %>,
                                          Other symptom: <%= notification.other_symptom.symptom_type %></p>
                                        <ul class="list-inline comment-list">
                                            <li><i class="fa fa-heartbeat"> </i>Submitted to: <%= notification.clinician.full_name %></li>
                                        </ul>
                                      <% else %>
                                        <% if notification.is_a?(PrfsAssessment) %>
                                          <strong><%= link_to "PRFS Assessment", prfs_assessment_path(notification) %><small class="pull-right"> <%= time_ago_in_words(notification.created_at) %></small></strong> 
                                          <p>Activity and Function score: <%= notification.activity_and_function %></p>
                                          <ul class="list-inline comment-list">
                                              <li><i class="fa fa-heartbeat"> </i>Submitted to: <%= notification.clinician.full_name %></li>
                                          </ul>
                                        <% else %>
                                          <strong><%= link_to "Comment", comment_path(notification) %><small class="pull-right"> <%= time_ago_in_words(notification.created_at) %></small></strong>
                                          <p><%= notification.general_comment %></p>
                                          <ul class="list-inline comment-list">
                                            <li><i class="fa fa-heartbeat"> </i>Sent by: 
                                              <% if notification.from == notification.patient.user_id %>
                                              <%= notification.patient.full_name %>
                                            <% else %>
                                              <%= notification.clinician.full_name %>
                                            <% end %>
                                            </li>
                                          </ul>
                                        <% end %>
                                      <% end %>
                                    </div>    
                                </div>
                            <% end %>
                          </div>
                      </div>    
                  </div><!--End Notifications Post-->

                  <!--Administrative Information-->
                  <div class="col-sm-4">
                      <div class="headline"><h3>Administrative Information</h3></div>
                        <div class="margin-bottom-30">
                            <p><strong>Shared with:</strong></p>
                            <% @patient.shared_clinicians.each do |list| %>
                              <p><%= link_to Clinician.find_by(id: list).full_name, clinician_path(list) %></p>
                            <% end %>
                            <p><strong>Patient deceased:</strong> &nbsp; <%= @patient.patient_deceased %></p>
                            <p><strong>Patient archived:</strong> &nbsp; &nbsp; <%= @patient.patient_archived %></p>
                            <p><strong>Care Notes:</strong></p>
                              <% @notes.each do |note| %>
                                <blockquote class="hero-unify margin-bottom-10">
                                  <p><%= note.care_note %></p>
                                  <small><%= note.clinician.full_name %>, <%= note.created_at.strftime("%B %d, %Y") %></small>
                                </blockquote>
                              <% end %>
                              <span class="pull-right">
                                <%= link_to "Add Note", new_note_path, class: 'btn btn-u btn-success' %>
                              </span>             
                        </div>
                      </div>        
                  </div>
                  <!--End Administrative Information-->

                <% else %><!--Patient View -->

                  <!--Patient Infromation - Patient View -->
                  <div class="col-sm-6">
                      <div class="panel panel-profile no-bg">
                          <div class="panel-heading overflow-h">
                              <h2 class="panel-title heading-sm pull-left"><i class="fa fa-bed"></i>Patient Information</h2>
                          </div>
                          <div id="scrollbar" class="panel-body contentHolder">
                                <div class="profile-post color-one">
                                    <span class="profile-post-numb"></span>
                                    <div class="profile-post-in">
                                        <p><strong>Gender:</strong> <%= @patient.gender.gender_type if @patient.gender %></p>
                                        <p><strong>Age:</strong> <%= @patient.age %></p>
                                        <p><strong>Address:</strong> <%= @patient.address %></p>
                                        <p><strong>Email:</strong> <%= User.find_by(id: @patient.user_id).email %></p>
                                        <p><strong>Phone number:</strong> <%= @patient.phone_number %></p>
                                        <% if @esas_assessments.last == nil %>
                                          <p><strong>Other symptom:</strong> <%= OtherSymptom.find_by(id: @patient.other_symptom).symptom_type %></p>
                                        <% else %>
                                          <p><strong>Last other symptom:</strong> <%= @esas_assessments.last.other_symptom.symptom_type %></p>
                                        <% end %>
                                        <p><strong>Caregiver name:</strong> <%= @patient.caregiver_name %></p>
                                    </div>
                                </div>
                          </div>
                      </div>        
                  </div>
                  <!--End Patient Information-->

                <% end %><!--End Patient View -->

                </div><!--/end row-->
              </div><!--End Profile Body-->
            </div>
        </div><!--/end row-->
    </div><!--/container-->    
    <!--=== End Profile ===-->

</body>